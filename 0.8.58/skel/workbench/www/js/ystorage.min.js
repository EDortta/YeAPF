/* YeAPF 0.8.58-39 built on 2017-06-12 17:18 (-3 DST) Copyright (C) 2004-2017 Esteban Daniel Dortta - dortta@yahoo.com */
(function(){window.ystorage||(window.ystorage=function(){var f=[],g={},a={};Object.defineProperty(g,"getItem",{value:function(b){return b?a[b]:null},writable:!1,configurable:!1,enumerable:!1});Object.defineProperty(g,"key",{value:function(b){return f[b]},writable:!1,configurable:!1,enumerable:!1});Object.defineProperty(g,"setItem",{value:function(b,a){b&&(document.cookie=escape(b)+"="+escape(a)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/")},writable:!1,configurable:!1,enumerable:!1});Object.defineProperty(g,
"length",{get:function(){return f.length},configurable:!1,enumerable:!1});Object.defineProperty(g,"removeItem",{value:function(b){b&&(document.cookie=escape(b)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/")},writable:!1,configurable:!1,enumerable:!1});a.get=function(){var b,a;for(a in g)b=f.indexOf(a),-1===b?g.setItem(a,g[a]):f.splice(b,1),delete g[a];for(;0<f.length;f.splice(0,1))g.removeItem(f[0]);for(var c=0,e=document.cookie.split(/\s*;\s*/);c<e.length;c++)b=e[c].split(/\s*=\s*/),1<b.length&&
(g[a=unescape(b[0])]=unescape(b[1]),f.push(a));return g};a.configurable=!1;a.enumerable=!0;return a}());window.ySingleDb||(console.log("Creating ySingleDb ... "),window.ySingleDb=function(f,g){var a={_list:null,toBinArray:function(b){for(var a=(b||"").length,c=new Uint8Array(a),e=0;e<a;e++)c[e]=b.charCodeAt(e);return c},toBinString:function(b){b=new Uint8Array(b);for(var a=[],c=0;65535*c<b.length;c++)a.push(String.fromCharCode.apply(null,b.subarray(65535*c,65535*(c+1))));return a.join("")},setItem:function(b,
d,c){var e,h,k;b=String(b);d._id=d._id||generateUUID();d._ts_update=(new Date).getTime()/1E3;if(isArray(c)&&(k=a.getItem(b),!isEmpty(k)))for(e=0;e<c.length;e++)"undefined"!==typeof k[c[e]]&&(d[c[e]]=k[c[e]]);if(d._linked){for(e=0;e<d._linked.length;e++)delete d[d._linked[e]];delete d._linked}for(h in d)d.hasOwnProperty(h)&&"_"!=h.substr(0,1)&&isArray(d[h])&&(d[h]=JSON.stringify(d[h]));localStorage.setItem(a._dbTag_+"_item_"+b,JSON.stringify(d));-1==a._list.indexOf(b)&&(a._list[a._list.length]=b,localStorage.setItem(a._dbTag_+
"_list",JSON.stringify(a._list)))},setBinItem:function(b,d,c){a.setItem(b,a.toBinString(d),c)},getItem:function(b){b=String(b);b=localStorage.getItem(a._dbTag_+"_item_"+b);b=JSON.parse(b||"{}");if(!isEmpty(b)&&isArray(a._siblingDB)){var d;b._linked=[];for(var c=0;c<a._siblingDB.length;c++){d=a._siblingDB[c].db.getItem(b[a._siblingDB[c].linkage]);for(var e in d)b._linked=[],d.hasOwnProperty(e)&&"undefined"==typeof b[e]&&(b[e]=d[e],b._linked.push(e))}}return b},getBinItem:function(b){return a.toBinArray(a.getItem(b))},
getList:function(){return a._list||[]},linkTo:function(b,d){b&&b.getItem?"undefined"==typeof d&&(b=null):b=d=null;if(b){var c={db:b,linkage:d||null};a._siblingDB=a._siblingDB||[];a._siblingDB.push(c)}},filter:function(b,d,c,e){if("function"==typeof b){c=c||!0;var h=!1,k;!0===c?h=!0:(k=yLexObj(c),k.parse());var l=a.getList(),f,g;for(c=0;c<l.length;c++)if(f=a.getItem(l[c]),g=h||k.solve(f))b(f),e&&(c=l.length+1)}"function"==typeof d&&d()},each:function(b,d,c,e){var h=function(b,a){a=String(a).split(" ");
var c=!0,d,e;for(d in a)e=trim(a[d]),c=isNumber(e)&&isNumber(b)?c&&parseFloat(e)===parseFloat(b):c&&0<=(""+b).toUpperCase().indexOf(e.toUpperCase());return c},f,l=a.getList(),g,m;for(f=0;f<l.length;f++)if("function"==typeof b){g=a.getItem(l[f]);m="undefined"==typeof c;if(!m)if("string"==typeof c)m=h(g[a.cfg.keyName],c);else if("object"==typeof c){m=!0;for(var n in c)c.hasOwnProperty(n)&&(m="undefined"!==typeof g[n]?m&&h(g[n],c[n]):!1)}m&&(b(g),e&&(f=l.length+1))}"function"==typeof d&&d()},insertData:function(b,
d){for(var c in b)b.hasOwnProperty(c)&&a.setItem(b[c][a._keyName_],b[c],d)},count:function(b){var d=0;a.each(function(){d++},null,b);return d},extractData:function(b,d){var c=[];a.each(function(a){c[c.length]=a},function(){b(c)},d)},fillList:function(b,d,c,e){d=d||"id";c&&a.cleanList();for(c=0;c<b.length;c++)b[c][d]&&a.setItem(b[c][d],b,e)},removeItem:function(b,d){if(("undefined"!==typeof d?d:1)&&"function"==typeof a.onremove)a.onremove(a.getItem(b));localStorage.removeItem(a._dbTag_+"_item_"+b);
var c=a._list.indexOf(String(b));-1<c&&(a._list.splice(c,1),localStorage.setItem(a._dbTag_+"_list",JSON.stringify(a._list)))},removeItems:function(b,d){d="undefined"!==typeof d?d:!0;a.extractData(function(b){for(var e in b)b.hasOwnProperty(e)&&a.removeItem(b[e][a._keyName_],d)},b)},eliminateItem:function(b){a.removeItem(b,!1)},eliminateItems:function(b){a.removeItems(b,!1)},cleanList:function(b){b="undefined"!==typeof b?b:!0;var d=[],c=0,e;for(e in a._list)d[c++]=a._list[e];for(c=0;c<d.length;c++)a.removeItem(d[c],
b)},blankList:function(){a.cleanList(!1)},init:function(b,d){a._dbTag_=b;a._keyName_=d||"_id";console.log("ystorage: creating "+b);a._list=localStorage.getItem(a._dbTag_+"_list");"string"==typeof a._list&&(a._list=JSON&&JSON.parse(a._list)||[]);a._list=a._list||[];return a}};return a.init(f,g)},console.log("ystorage ready!"));window.yIndexedDB||(window.indexedDB||(window.indexedDB=window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB),window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||
window.msIDBTransaction,window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange,window.yIndexedDB=function(f,g,a){var b={_newTransaction:function(a,c,e){e=e||function(a){0!==a&&f&&(f=!1,"function"==typeof c&&c(520,a,{}))};a=b._db.transaction([b._dbTag_],"readwrite");var h,f=!0;a.oncomplete=function(){h=0;"function"==typeof e&&e(h)};a.onerror=function(){h=1;"function"==typeof e&&e(h)};return a.objectStore(b._dbTag_)},setItem:function(a,c,e){a=!1;if(3==b.status){var h=
b._newTransaction("readwrite",e).put(c);h.onsuccess=function(){"function"==typeof e&&e(200,0,h.result)};a=!0}return a},getItem:function(a,c){var e=!1;if(3==b.status){var h=b._newTransaction("readonly",c).get(a);h.onsuccess=function(){"function"==typeof c&&c(200,0,h.result)};e=!0}return e},insertData:function(a,b){},filter:function(a,c,e,h){if(3==b.status){var f=function(a){0===a&&"function"==typeof c&&c()};if("function"==typeof a){e=e||!0;var g=!1;if(!0===e)g=!0;else{var p=yLexObj(e);p.parse()}e=
b._newTransaction("readonly",void 0,f).openCursor();e.onsuccess=function(b){var c=b.target.result;c&&((b=g||p.solve(c.value))&&a(c.value),h||c.continue())};e.onerror=function(){}}else f(0)}},removeItem:function(a,c){var e=!1;if(3==b.status){var f=b._newTransaction("readonly",c).delete(a);f.onsuccess=function(){"function"==typeof c&&c(200,0,f.result)};e=!0}return e},onDBRequestError:function(a){b._status=-1;console.error("yIndexedDB error trying to open '{0}'".format(f))},onDBRequestSuccess:function(d){b._status=
3;b._db=d.target.result;"function"==typeof a&&a()},onDBUpgradeNeeded:function(a){b._status=2;b._db=a.target.result;b._objectStore=b._db.createObjectStore(b._dbTag_,{keyPath:b._keyName_[0]});for(a=1;a<b._keyName_.length;a++)b._objectStore.createIndex(b._keyName_[a]+"_ndx",b._keyName_[a],{unique:!1});b._status=3},init:function(a,c){b._dbTag_=a;c=c||"_id";if(!isArray(c)){var e=0<=c.indexOf(",")?",":";";c=c.split(e)}b._keyName_=c.slice();0===b._keyName_.length&&(b._keyName_[0]="_id");b._status=0;Object.defineProperty(b,
"status",{get:function(){return b._status},configurable:!1,enumerable:!1});window.indexedDB&&(b._status=1,b._DBOpenRequest=window.indexedDB.open(a,1),b._DBOpenRequest.onerror=b.onDBRequestError,b._DBOpenRequest.onsuccess=b.onDBRequestSuccess,b._DBOpenRequest.onupgradeneeded=b.onDBUpgradeNeeded);return b}};return b.init(f,g)});window.yServerWatcherObj||(window.yServerWatcherObj=function(f){var g={serverReady:function(a,b){var d=(new Date).getTime();ycomm.crave("sync","ping",null,function(c,e,f){200==
c?0<parseInt(f.pong||0)&&(c=(new Date).getTime()-d,console.log("Server ready..."),console.log("Wasted time: {0}ms".format(c)),ycomm.wd_interval=4*c,"function"==typeof a&&a()):"function"==typeof b&&b(c,e)})},init:function(){ycomm.setDataLocation(f);g.serverReady(function(){console.log("Server ready!")});return g}};return g.init()});window.yInfoObj||(window.yInfoObj=function(f,g){var a={};if("object"==typeof f&&"string"==typeof f.dbName)return a.cfg={db:ySingleDb(f.dbName,f.keyName),garbage:ySingleDb(f.dbName+
"_garbage",f.keyName),dbName:f.dbName,keyName:f.keyName,dataModified:0,onrecordcount:null,onprogress:null,oncomplete:null},a.onremove=function(b){b._ts_deletion=(new Date).getTime()/1E3;a.cfg.garbage.setItem(b._id,b);a.cfg.dataModified++},a.isbusy=function(){return a.busy},a.getItem=function(b){return a.cfg.db.getItem(b)},a.setItem=function(b,d,c){a.cfg.dataModified++;return a.cfg.db.setItem(b,d,c)},a.removeItem=function(b){return a.cfg.db.removeItem(b)},a.removeItems=function(b){return a.cfg.db.removeItems(b)},
a.eliminateItem=function(b){return a.cfg.db.eliminateItem(b)},a.eliminateItems=function(b){return a.cfg.db.eliminateItems(b)},a.cleanList=function(){return a.cfg.db.cleanList()},a.blankList=function(){return a.cfg.db.blankList()},a.linkTo=function(b,d){return a.cfg.db.linkTo(b,d)},a.filter=function(b,d,c,e){return a.cfg.db.filter(b,d,c,e)},a.each=function(b,d,c,e){return a.cfg.db.each(b,d,c,e)},a.paint=a.each,a.count=function(b){return a.cfg.db.count(b)},a.extractData=function(b,d){var c=[];a.each(function(a){c[c.length]=
a},function(){b(c)},d)},a.insertData=function(b,d){return a.cfg.db.insertData(b,d)},a.cleanCondition=function(){a.cfg.condition={}},a.setCondition=function(b){if("string"==typeof b){b=b.match(/\S+/g);var d,c="";for(d=0;d<b.length;d++)isNumber(b[d])||isOperator(b[d])||(b[d]="%("+b[d]+")"),c+=b[d]+" ";a.cfg.condition={_statement_:c}}else a.cfg.condition=b||{}},a.retrieveFromServer=function(b,d,c){var e=function(){var b={xq_start:a.cfg.xq_start,xq_collectionName:a.cfg.dbName},c=(new Date).getTime();
mergeObject(a.cfg.condition,b);ycomm.crave("sync","getDocumentInSequence",b,function(b,d,f){if(0<f.length){a.cfg.interleave.adjustRestTime(c);for(b=0;b<f.length;b++)if(a.setItem(f[b][a.cfg.keyName],f[b]),"function"==typeof a.cfg.onprogress)a.cfg.onprogress(a.cfg.dbName,f[b],a.cfg.xq_start+b);a.cfg.xq_start+=f.length;setTimeout(e,a.cfg.interleave.restTime)}else{if("function"==typeof a.cfg.oncomplete)a.cfg.oncomplete(a.cfg.dbName);a.busy=!1}})};if(a.busy)return console.warn("yInfoObj busy"),!1;a.busy=
!0;a.cfg.onrecordcount=b||null;a.cfg.oncomplete=d||null;a.cfg.onprogress=c||null;a.server.serverReady(function(){ycomm.crave("sync","getRecordCount",a.cfg.condition,function(b,c,d){d=d||[];d[0]=d[0]||{};if("function"==typeof a.cfg.onrecordcount)a.cfg.onrecordcount(a.cfg.dbName,parseInt(d[0].CC||0));a.cfg.xq_start=0;e()})},function(a,b){console.log("Erro {0} ao tentar acessar o servidor: {1}".format(a,b.message))});return!0},a.templatedData=function(b){var d;if(a.cfg.dataTemplateEmpty)d=b;else{d={};
for(var c in a.cfg.dataTemplate)a.cfg.dataTemplate.hasOwnProperty(c)&&(d[c]=b[c])}return d},a.sendToServer=function(b,d){if(a.busy)return console.warn("yInfoObj busy"),!1;a.busy=!0;a.cfg.onrecordcount=null;a.cfg.oncomplete=b||null;a.cfg.onprogress=d||null;var c=0;a.server.serverReady(function(){a.each(function(b){var d=a.templatedData(b);b._ts_upload=(new Date(b)).getTime()/1E3;mergeObject(a.cfg.condition,d);ycomm.crave("sync","setDocument",d,function(b,d,e){if(200==b&&"function"==typeof a.cfg.onprogress)a.cfg.onprogress(a.cfg.dbName,
e[0],++c)})},function(){if("function"==typeof a.cfg.oncomplete)a.cfg.oncomplete(a.cfg.dbName);a.busy=!1},a.cfg.condition)},function(a,b){console.log("Erro {0} ao tentar acessar o servidor: {1}".format(a,b.message))});return!0},a.init=function(b){a.cfg.interleave=yRestTimeControl(500);a.cfg.dataTemplateEmpty="undefined"===typeof b?!0:!1;a.cfg.dataTemplate=b||{};a.cfg.db.onremove=a.onremove;a.server=yServerWatcherObj(restServer);a.cleanCondition();return a},a.init(f.dataTemplate);console.error("Since 0.8.55 the parameters or yInfoObj() has changed to (aDBSpec: {}, aServerSpec: {})");
alert("Since 0.8.55 the parameters or yInfoObj() has changed to (aDBSpec: {}, aServerSpec: {})")})})();
