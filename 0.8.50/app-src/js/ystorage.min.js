window.ystorage||Object.defineProperty(window,"ystorage",new function(){var f=[],a={};Object.defineProperty(a,"getItem",{value:function(c){return c?this[c]:null},writable:!1,configurable:!1,enumerable:!1});Object.defineProperty(a,"key",{value:function(c){return f[c]},writable:!1,configurable:!1,enumerable:!1});Object.defineProperty(a,"setItem",{value:function(c,b){c&&(document.cookie=escape(c)+"="+escape(b)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/")},writable:!1,configurable:!1,enumerable:!1});
Object.defineProperty(a,"length",{get:function(){return f.length},configurable:!1,enumerable:!1});Object.defineProperty(a,"removeItem",{value:function(c){c&&(document.cookie=escape(c)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/")},writable:!1,configurable:!1,enumerable:!1});this.get=function(){var c,b;for(b in a)c=f.indexOf(b),-1===c?a.setItem(b,a[b]):f.splice(c,1),delete a[b];for(;0<f.length;f.splice(0,1))a.removeItem(f[0]);for(var d=0,g=document.cookie.split(/\s*;\s*/);d<g.length;d++)c=g[d].split(/\s*=\s*/),
1<c.length&&(a[b=unescape(c[0])]=unescape(c[1]),f.push(b));return a};this.configurable=!1;this.enumerable=!0});
window.ySingleDb||(console.log("Creating ySingleDb ... "),window.ySingleDb=function(f){var a={_list:null,toBinArray:function(c){for(var b=(c||"").length,d=new Uint8Array(b),a=0;a<b;a++)d[a]=c.charCodeAt(a);return d},toBinString:function(c){c=new Uint8Array(c);for(var b=[],d=0;65535*d<c.length;d++)b.push(String.fromCharCode.apply(null,c.subarray(65535*d,65535*(d+1))));return b.join("")},setItem:function(c,b){c=String(c);b._id=generateUUID()||b._id;b._ts_update=(new Date).getTime()/1E3;localStorage.setItem(a._dbTag_+
"_item_"+c,JSON.stringify(b));-1==a._list.indexOf(c)&&(a._list[a._list.length]=c,localStorage.setItem(a._dbTag_+"_list",JSON.stringify(a._list)))},setBinItem:function(c,b){a.setItem(c,a.toBinString(b))},getItem:function(c){c=String(c);c=localStorage.getItem(a._dbTag_+"_item_"+c);return c=JSON.parse(c||"{}")},getBinItem:function(c){return a.toBinArray(a.getItem(c))},getList:function(){return a._list||[]},fillList:function(c,b,d){b=b||"id";d&&a.cleanList();for(d=0;d<c.length;d++)c[d][b]&&a.setItem(c[d][b],
c)},removeItem:function(c){if("function"==typeof a.onremove)a.onremove(a.getItem(c));localStorage.removeItem(a._dbTag_+"_item_"+c);c=a._list.indexOf(String(c));-1<c&&(a._list.splice(c,1),localStorage.setItem(a._dbTag_+"_list",JSON.stringify(a._list)))},cleanList:function(){for(var c in a._list)id=a._list[c],a.removeItem(id)},init:function(c){a._dbTag_=c;console.log("ystorage: creating "+c);a._list=localStorage.getItem(a._dbTag_+"_list");"string"==typeof a._list&&(a._list=JSON&&JSON.parse(a._list)||
[]);a._list=a._list||[];return a}};return a.init(f)},console.log("ystorage ready!"));
window.yServerWatcherObj||(window.yServerWatcherObj=function(f){var a={serverReady:function(c,b){var d=(new Date).getTime();ycomm.crave("sync","ping",null,function(a,e,h){200==a?0<parseInt(h.pong||0)&&(a=(new Date).getTime()-d,console.log("Server ready..."),console.log("Wasted time: {0}ms".format(a)),ycomm.wd_interval=4*a,"function"==typeof c&&c()):"function"==typeof b&&b(a,e)})},init:function(){ycomm.setDataLocation(f);a.serverReady(function(){console.log("Server ready!")});return a}};return a.init()});
window.yInfoObj||(window.yInfoObj=function(f,a,c){var b={};b.cfg={db:ySingleDb(a),garbage:ySingleDb(a+"_garbage"),dbName:a,keyName:c,dataModified:0,onrecordcount:null,onprogress:null,oncomplete:null};b.onremove=function(a){a._ts_deletion=(new Date).getTime()/1E3;b.cfg.garbage.setItem(a._id,a);b.cfg.dataModified++};b.isbusy=function(){return b.busy};b.getItem=function(a){return b.cfg.db.getItem(a)};b.setItem=function(a,c){b.cfg.dataModified++;return b.cfg.db.setItem(a,c)};b.removeItem=function(a){return b.cfg.db.removeItem(a)};
b.filter=function(a,c,e){if("function"==typeof a){c=yLexObj(e||!0);c.parse();var h=b.cfg.db.getList(),n,f;for(e=0;e<h.length;e++)n=b.cfg.db.getItem(h[e]),(f=c.solve(n))&&a(n)}};b.each=function(a,c,e){var h=function(b,a){a=String(a).split(" ");var c=!0,d,g;for(d in a)g=trim(a[d]),c=isNumber(g)&&isNumber(b)?c&&parseFloat(g)===parseFloat(b):c&&0<=b.toUpperCase().indexOf(g.toUpperCase());return c},f,p=b.cfg.db.getList(),l,k;for(f=0;f<p.length;f++)if("function"==typeof a){l=b.cfg.db.getItem(p[f]);k="undefined"==
typeof e;if(!k)if("string"==typeof e)k=h(l[b.cfg.keyName],e);else if("object"==typeof e){k=!0;for(var m in e)e.hasOwnProperty(m)&&(k="undefined"!==typeof l[m]?k&&h(l[m],e[m]):!1)}k&&a(l)}"function"==typeof c&&c()};b.paint=b.each;b.count=function(a){var c=0;b.each(function(){c++},null,a);return c};b.extractData=function(a,c){var e=[];b.each(function(b){e[e.length]=b},function(){a(e)},c)};b.insertData=function(a){for(var c=0;c<a.length;c++)b.setItem(a[c][b.cfg.keyName],a[c])};b.cleanCondition=function(){b.cfg.condition=
{}};b.setCondition=function(a){if("string"==typeof a){a=a.match(/\S+/g);var c,e="";for(c=0;c<a.length;c++)isNumber(a[c])||isOperator(a[c])||(a[c]="%("+a[c]+")"),e+=a[c]+" ";b.cfg.condition={_statement_:e}}else b.cfg.condition=a||{}};b._retrieveFromServer=function(){var a={xq_start:b.cfg.xq_start};mergeObject(b.cfg.condition,a);ycomm.crave("sync","getRecordInfo_"+b.cfg.dbName,a,function(a,c,d){if(0<d.length){for(a=0;a<d.length;a++)if(b.setItem(d[a][b.cfg.keyName],d[a]),"function"==typeof b.cfg.onprogress)b.cfg.onprogress(b.cfg.dbName,
d[a],b.cfg.xq_start+a);b.cfg.xq_start+=d.length;setTimeout(b._retrieveFromServer,500)}else{if("function"==typeof b.cfg.oncomplete)b.cfg.oncomplete(b.cfg.dbName);b.busy=!1}})};b.retrieveFromServer=function(a,c,e){if(b.busy)return console.warn("yInfoObj busy"),!1;b.busy=!0;b.cfg.onrecordcount=a||null;b.cfg.oncomplete=c||null;b.cfg.onprogress=e||null;b.server.serverReady(function(){ycomm.crave("sync","getRecordCount_"+b.cfg.dbName,b.cfg.condition,function(a,c,d){d=d||[];d[0]=d[0]||{};if("function"==
typeof b.cfg.onrecordcount)b.cfg.onrecordcount(b.cfg.dbName,parseInt(d[0].CC||0));b.cfg.xq_start=0;b._retrieveFromServer()})},function(b,a){console.log("Erro {0} ao tentar acessar o servidor: {1}".format(b,a.message))});return!0};b.sendToServer=function(a,c){if(b.busy)return console.warn("yInfoObj busy"),!1;b.busy=!0;b.cfg.onrecordcount=null;b.cfg.oncomplete=a||null;b.cfg.onprogress=c||null;var e=0;b.server.serverReady(function(){b.each(function(a){a._ts_upload=(new Date(a)).getTime()/1E3;mergeObject(b.cfg.condition,
a);ycomm.crave("sync","setRecordInfo_"+b.cfg.dbName,a,function(a,c,d){if(200==a&&"function"==typeof b.cfg.onprogress)b.cfg.onprogress(b.cfg.dbName,d[0],++e)})},function(){if("function"==typeof b.cfg.oncomplete)b.cfg.oncomplete(b.cfg.dbName);b.busy=!1},b.cfg.condition)},function(a,b){console.log("Erro {0} ao tentar acessar o servidor: {1}".format(a,b.message))});return!0};b.init=function(){db.onremove=b.onremove;b.server=yServerWatcherObj(f);b.cleanCondition();return b};return b.init()});
